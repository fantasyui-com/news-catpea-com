import{S as t,i as a,s as e,f as n,g as o,l,d as r,j as i,k as s,a as c,m as d,n as m,G as u,r as f,H as p,u as g,I as h,z as $,A as v,C as y,J as b,t as x,h as T,B as E,D as w,q as L,L as j,o as I,K as M,M as k,F as O,N as S}from"./client.cb8c0d9c.js";import"./Post.bd17c81b.js";import{T as P}from"./Tail.6f4a9287.js";import{S as D}from"./Song.c0ec66f0.js";var H=function(t,a,e=0){const n=Math.abs(a-e);let o=100*parseFloat(t-e)/parseFloat(n)/100;return parseInt(100*o)};function V(t){let a,e,u,f;return{c(){a=n("div"),e=n("div"),this.h()},l(t){a=o(t,"DIV",{class:!0});var n=l(a);e=o(n,"DIV",{class:!0,role:!0,style:!0,"aria-valuenow":!0,"aria-valuemin":!0,"aria-valuemax":!0}),l(e).forEach(r),n.forEach(r),this.h()},h(){i(e,"class",u="progress-bar progress-bar-striped bg-"+t[0]),i(e,"role","progressbar"),s(e,"width",H(t[1],t[3],t[2])+"%"),i(e,"aria-valuenow",f=H(t[1],t[3],t[2])),i(e,"aria-valuemin","0"),i(e,"aria-valuemax","100"),i(a,"class","progress")},m(t,n){c(t,a,n),d(a,e)},p(t,[a]){1&a&&u!==(u="progress-bar progress-bar-striped bg-"+t[0])&&i(e,"class",u),14&a&&s(e,"width",H(t[1],t[3],t[2])+"%"),14&a&&f!==(f=H(t[1],t[3],t[2]))&&i(e,"aria-valuenow",f)},i:m,o:m,d(t){t&&r(a)}}}function N(t,a,e){let{color:n="primary"}=a,{val:o=0}=a,{min:l=0}=a,{max:r=100}=a;return t.$set=(t=>{"color"in t&&e(0,n=t.color),"val"in t&&e(1,o=t.val),"min"in t&&e(2,l=t.min),"max"in t&&e(3,r=t.max)}),[n,o,l,r]}class A extends t{constructor(t){super(),a(this,t,N,V,e,{color:0,val:1,min:2,max:3})}}function B(t,a,e){const n=t.slice();return n[12]=a[e],n[14]=e,n}function C(t){let a,e,u,f,p;return{c(){a=n("button"),e=n("img"),f=x(" Play"),this.h()},l(t){a=o(t,"BUTTON",{type:!0,class:!0});var n=l(a);e=o(n,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),f=T(n," Play"),n.forEach(r),this.h()},h(){e.src!==(u="/icons/play.svg")&&i(e,"src","/icons/play.svg"),i(e,"alt",""),i(e,"width","32"),i(e,"height","32"),s(e,"filter","invert(1)"),i(a,"type","button"),i(a,"class","btn btn-lg btn-primary btn-block")},m(n,o,l){c(n,a,o),d(a,e),d(a,f),l&&p(),p=$(a,"click",t[7])},p:m,d(t){t&&r(a),p()}}}function F(t){let a,e,u,f,p;return{c(){a=n("button"),e=n("img"),f=x(" Stop"),this.h()},l(t){a=o(t,"BUTTON",{type:!0,class:!0});var n=l(a);e=o(n,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),f=T(n," Stop"),n.forEach(r),this.h()},h(){e.src!==(u="/icons/stop.svg")&&i(e,"src","/icons/stop.svg"),i(e,"alt",""),i(e,"width","32"),i(e,"height","32"),s(e,"filter","invert(1)"),i(a,"type","button"),i(a,"class","btn bg-dark btn-lg btn-block")},m(n,o,l){c(n,a,o),d(a,e),d(a,f),l&&p(),p=$(a,"click",t[6])},p:m,d(t){t&&r(a),p()}}}function G(t){let a;return{c(){a=x("Stop Mode")},l(t){a=T(t,"Stop Mode")},m(t,e){c(t,a,e)},d(t){t&&r(a)}}}function U(t){let a;return{c(){a=x("Play Mode")},l(t){a=T(t,"Play Mode")},m(t,e){c(t,a,e)},d(t){t&&r(a)}}}function q(t){let a,e,i,s;const m=new D({props:{active:t[2]==t[14],data:t[12],read:"/read/"+t[12].id}});function x(...a){return t[11](t[14],...a)}return{c(){a=n("div"),u(m.$$.fragment),e=f()},l(t){a=o(t,"DIV",{});var n=l(a);p(m.$$.fragment,n),e=g(n),n.forEach(r)},m(t,n,o){c(t,a,n),h(m,a,null),d(a,e),i=!0,o&&s(),s=$(a,"click",x)},p(a,e){t=a;const n={};4&e&&(n.active=t[2]==t[14]),1&e&&(n.data=t[12]),1&e&&(n.read="/read/"+t[12].id),m.$set(n)},i(t){i||(v(m.$$.fragment,t),i=!0)},o(t){y(m.$$.fragment,t),i=!1},d(t){t&&r(a),b(m),s()}}}function z(t){let a,e,s,m,$,j,I,M,k,O,S,P,D,H,V,N,z=Object.keys(t[3].data).map(t[8]).map(J).join("")+"",Q=Object.keys(t[3].meta).map(t[9]).map(K).join("")+"",W=Object.keys(t[3].info).map(t[10]).map(R).join("")+"";function X(t,a){return t[1]?F:C}let Y=X(t),Z=Y(t);function _(t,a){return t[1]?U:G}let tt=_(t),at=tt(t);const et=new A({props:{color:"warning",val:t[3].meta.loaded,max:t[3].meta.total}}),nt=new A({props:{color:"warning",val:t[3].meta.currentTime,max:t[3].meta.duration}});let ot=t[0],lt=[];for(let a=0;a<ot.length;a+=1)lt[a]=q(B(t,ot,a));const rt=t=>y(lt[t],1,1,()=>{lt[t]=null});return{c(){a=n("div"),e=n("div"),Z.c(),s=f(),at.c(),m=x("\n\n\n  Loading\n  "),u(et.$$.fragment),$=x("\n\n  Playing\n  "),u(nt.$$.fragment),j=f(),I=n("hr"),M=f(),k=n("ol"),O=f(),S=n("ol"),P=f(),D=n("ol"),H=f(),V=n("div");for(let t=0;t<lt.length;t+=1)lt[t].c();this.h()},l(t){a=o(t,"DIV",{class:!0});var n=l(a);e=o(n,"DIV",{class:!0});var i=l(e);Z.l(i),s=g(i),at.l(i),m=T(i,"\n\n\n  Loading\n  "),p(et.$$.fragment,i),$=T(i,"\n\n  Playing\n  "),p(nt.$$.fragment,i),j=g(i),I=o(i,"HR",{}),M=g(i),k=o(i,"OL",{}),l(k).forEach(r),O=g(i),S=o(i,"OL",{}),l(S).forEach(r),P=g(i),D=o(i,"OL",{}),l(D).forEach(r),i.forEach(r),H=g(n),V=o(n,"DIV",{class:!0});var c=l(V);for(let t=0;t<lt.length;t+=1)lt[t].l(c);c.forEach(r),n.forEach(r),this.h()},h(){i(e,"class","col-lg-8"),i(V,"class","col-lg-4"),i(a,"class","row")},m(t,n){c(t,a,n),d(a,e),Z.m(e,null),d(e,s),at.m(e,null),d(e,m),h(et,e,null),d(e,$),h(nt,e,null),d(e,j),d(e,I),d(e,M),d(e,k),k.innerHTML=z,d(e,O),d(e,S),S.innerHTML=Q,d(e,P),d(e,D),D.innerHTML=W,d(a,H),d(a,V);for(let t=0;t<lt.length;t+=1)lt[t].m(V,null);N=!0},p(t,[a]){Y===(Y=X(t))&&Z?Z.p(t,a):(Z.d(1),(Z=Y(t))&&(Z.c(),Z.m(e,s))),tt!==(tt=_(t))&&(at.d(1),(at=tt(t))&&(at.c(),at.m(e,m)));const n={};8&a&&(n.val=t[3].meta.loaded),8&a&&(n.max=t[3].meta.total),et.$set(n);const o={};if(8&a&&(o.val=t[3].meta.currentTime),8&a&&(o.max=t[3].meta.duration),nt.$set(o),(!N||8&a)&&z!==(z=Object.keys(t[3].data).map(t[8]).map(J).join("")+"")&&(k.innerHTML=z),(!N||8&a)&&Q!==(Q=Object.keys(t[3].meta).map(t[9]).map(K).join("")+"")&&(S.innerHTML=Q),(!N||8&a)&&W!==(W=Object.keys(t[3].info).map(t[10]).map(R).join("")+"")&&(D.innerHTML=W),21&a){let e;for(ot=t[0],e=0;e<ot.length;e+=1){const n=B(t,ot,e);lt[e]?(lt[e].p(n,a),v(lt[e],1)):(lt[e]=q(n),lt[e].c(),v(lt[e],1),lt[e].m(V,null))}for(E(),e=ot.length;e<lt.length;e+=1)rt(e);w()}},i(t){if(!N){v(et.$$.fragment,t),v(nt.$$.fragment,t);for(let t=0;t<ot.length;t+=1)v(lt[t]);N=!0}},o(t){y(et.$$.fragment,t),y(nt.$$.fragment,t),lt=lt.filter(Boolean);for(let t=0;t<lt.length;t+=1)y(lt[t]);N=!1},d(t){t&&r(a),Z.d(),at.d(),b(et),b(nt),L(lt,t)}}}const J=t=>`<li>${t}</li>`,K=t=>`<li>${t}</li>`,R=t=>`<li>${t}</li>`;function Q(t,a,e){const n=(o=o||Object.create(null),{on:function(t,a){(o[t]||(o[t]=[])).push(a)},off:function(t,a){o[t]&&o[t].splice(o[t].indexOf(a)>>>0,1)},emit:function(t,a){(o[t]||[]).slice().map(function(t){t(a)}),(o["*"]||[]).slice().map(function(e){e(t,a)})}});var o;let{collection:l=[]}=a;j(()=>{n.emit("stop")});let r=l.map(t=>({data:{},info:t,meta:{currentTime:0,duration:0,loaded:0,total:0,ready:!1}})),i=!1,s=0,c=r[0];n.on("play",async({index:t})=>{e(1,i=!0);r.filter(t=>t.data.src).filter(t=>!t.data.paused).map(t=>(t.data.pause(),t.data.currentTime=0,t));try{e(3,c.data.currentTime=0,c),await c.data.play(),console.log("playing")}catch(t){console.error("not playing",t)}n.emit("preload",{index:t+1})}),n.on("stop",()=>{e(1,i=!1);r.filter(t=>t.data.src).filter(t=>!t.data.paused).map(t=>(t.data.pause(),t.data.currentTime=0,t))}),n.on("load",({index:t,play:a})=>{let e=r[t];console.log(`load got track ${e.info.title}`),console.log(`load loading ${e.info.audio}`),e.data.src||(e.data=new Audio(e.info.audio)),4===e.data.readyState&&(console.log(`bootleg canplaythrough ${e.info.title}`),e.meta.ready=!0,a&&n.emit("play",{index:t})),e.data.addEventListener("loadeddata",()=>{e.meta.duration=e.data.duration}),e.data.addEventListener("progress",function(t){t.lengthComputable?(e.meta.total=t.total,e.meta.loaded=t.loaded):console.log("Progress event is not lengthComputable...",this.explicitTotal)}),e.data.addEventListener("timeupdate",t=>{e.meta.currentTime=e.data.currentTime}),e.data.addEventListener("canplaythrough",()=>{e.meta.ready||(e.meta.ready=!0,console.log(`real canplaythrough ${e.info.title}`),a&&n.emit("play",{index:t}))})}),n.on("preload",({index:t,play:a})=>{let e=t;e+1>r.length&&(e=0);let n=r[t];console.log(`pre-load got track ${n.info.title}`),console.log(`pre-load loading ${n.info.audio}`),n.data.src||(n.data=new Audio(n.info.audio)),4===n.data.readyState&&(n.meta.ready=!0,console.log(`Pre-loaded ${n.info.title}`)),n.data.addEventListener("loadeddata",()=>{n.meta.duration=n.data.duration}),n.data.addEventListener("timeupdate",t=>{n.meta.currentTime=n.data.currentTime}),n.data.addEventListener("canplaythrough",()=>{n.meta.ready||(n.meta.ready=!0,console.log(`Pre-loaded ${n.info.title}`))})}),n.on("select",({index:t})=>{console.log(`Selecting ${r[t].info.title}`),e(2,s=t),e(3,c=r[s]),console.log(`Loading ${c.info.title}`),n.emit("load",{index:t,play:!0})}),I(()=>{setInterval(function(){e(3,c=r[s])},300)});return t.$set=(t=>{"collection"in t&&e(0,l=t.collection)}),[l,i,s,c,n,r,()=>n.emit("stop"),()=>{n.emit("select",{index:s})},t=>`${t}: ${c.data[t]}`,t=>`${t}: ${c.meta[t]}`,t=>`${t}: ${c.info[t]}`,t=>n.emit("select",{index:t})]}class W extends t{constructor(t){super(),a(this,t,Q,z,e,{collection:0})}}function X(t){let a,e,s,m,$,x,T;document.title=a=t[1].title;const E=new W({props:{collection:t[0]}}),w=new P({});return{c(){e=f(),s=n("main"),m=n("section"),$=n("div"),u(E.$$.fragment),x=f(),u(w.$$.fragment),this.h()},l(t){M('[data-svelte="svelte-cjhwof"]',document.head).forEach(r),e=g(t),s=o(t,"MAIN",{role:!0});var a=l(s);m=o(a,"SECTION",{});var n=l(m);$=o(n,"DIV",{class:!0});var i=l($);p(E.$$.fragment,i),i.forEach(r),n.forEach(r),a.forEach(r),x=g(t),p(w.$$.fragment,t),this.h()},h(){i($,"class","container"),i(s,"role","main")},m(t,a){c(t,e,a),c(t,s,a),d(s,m),d(m,$),h(E,$,null),c(t,x,a),h(w,t,a),T=!0},p(t,[e]){(!T||2&e)&&a!==(a=t[1].title)&&(document.title=a);const n={};1&e&&(n.collection=t[0]),E.$set(n)},i(t){T||(v(E.$$.fragment,t),v(w.$$.fragment,t),T=!0)},o(t){y(E.$$.fragment,t),y(w.$$.fragment,t),T=!1},d(t){t&&r(e),t&&r(s),b(E),t&&r(x),b(w,t)}}}function Y(t,a,e){const n=O();let o=null,l=k().filter(t=>t.audio);function r(){e(0,l=l.map(t=>(t.ago=S(t.date).from(S()),t))),e(0,l=l.map(t=>(t.today=S().diff(S(t.date),"days")<1,t))),n.blinkenlighten&&(e(0,l=l.map(t=>(t.ago=S(S(t.date).add(parseInt(31*Math.random()),"days")).from(S()),t))),e(0,l=l.map((t,a)=>(t.today=Math.random()<.5,t))))}return r(),j(()=>{clearInterval(o)}),I(()=>{o=setInterval(r,n.recalculateInterval)}),[l,n]}export default class extends t{constructor(t){super(),a(this,t,Y,X,e,{})}}
