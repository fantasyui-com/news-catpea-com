import{S as a,i as t,s as e,f as n,g as o,l,d as r,j as i,k as s,a as c,m as d,n as m,G as f,r as u,H as p,u as g,I as h,z as $,A as v,C as y,J as b,t as x,h as E,B as T,D as w,q as L,L as j,o as I,K as M,M as k,F as O,N as S}from"./client.f4c73aac.js";import"./Post.afa2689c.js";import{T as P}from"./Tail.832053f7.js";import{S as D}from"./Song.f60d90a9.js";var H=function(a,t,e=0){const n=Math.abs(t-e);let o=100*parseFloat(a-e)/parseFloat(n)/100;return parseInt(100*o)};function V(a){let t,e,f,u;return{c(){t=n("div"),e=n("div"),this.h()},l(a){t=o(a,"DIV",{class:!0});var n=l(t);e=o(n,"DIV",{class:!0,role:!0,style:!0,"aria-valuenow":!0,"aria-valuemin":!0,"aria-valuemax":!0}),l(e).forEach(r),n.forEach(r),this.h()},h(){i(e,"class",f="progress-bar progress-bar-striped bg-"+a[0]),i(e,"role","progressbar"),s(e,"width",H(a[1],a[3],a[2])+"%"),i(e,"aria-valuenow",u=H(a[1],a[3],a[2])),i(e,"aria-valuemin","0"),i(e,"aria-valuemax","100"),i(t,"class","progress")},m(a,n){c(a,t,n),d(t,e)},p(a,[t]){1&t&&f!==(f="progress-bar progress-bar-striped bg-"+a[0])&&i(e,"class",f),14&t&&s(e,"width",H(a[1],a[3],a[2])+"%"),14&t&&u!==(u=H(a[1],a[3],a[2]))&&i(e,"aria-valuenow",u)},i:m,o:m,d(a){a&&r(t)}}}function N(a,t,e){let{color:n="primary"}=t,{val:o=0}=t,{min:l=0}=t,{max:r=100}=t;return a.$set=(a=>{"color"in a&&e(0,n=a.color),"val"in a&&e(1,o=a.val),"min"in a&&e(2,l=a.min),"max"in a&&e(3,r=a.max)}),[n,o,l,r]}class A extends a{constructor(a){super(),t(this,a,N,V,e,{color:0,val:1,min:2,max:3})}}function B(a,t,e){const n=a.slice();return n[12]=t[e],n[14]=e,n}function C(a){let t,e,f,u,p;return{c(){t=n("button"),e=n("img"),u=x(" Play"),this.h()},l(a){t=o(a,"BUTTON",{type:!0,class:!0});var n=l(t);e=o(n,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),u=E(n," Play"),n.forEach(r),this.h()},h(){e.src!==(f="/icons/play.svg")&&i(e,"src","/icons/play.svg"),i(e,"alt",""),i(e,"width","32"),i(e,"height","32"),s(e,"filter","invert(1)"),i(t,"type","button"),i(t,"class","btn btn-lg btn-primary btn-block")},m(n,o,l){c(n,t,o),d(t,e),d(t,u),l&&p(),p=$(t,"click",a[7])},p:m,d(a){a&&r(t),p()}}}function F(a){let t,e,f,u,p;return{c(){t=n("button"),e=n("img"),u=x(" Stop"),this.h()},l(a){t=o(a,"BUTTON",{type:!0,class:!0});var n=l(t);e=o(n,"IMG",{src:!0,alt:!0,width:!0,height:!0,style:!0}),u=E(n," Stop"),n.forEach(r),this.h()},h(){e.src!==(f="/icons/stop.svg")&&i(e,"src","/icons/stop.svg"),i(e,"alt",""),i(e,"width","32"),i(e,"height","32"),s(e,"filter","invert(1)"),i(t,"type","button"),i(t,"class","btn bg-dark btn-lg btn-block")},m(n,o,l){c(n,t,o),d(t,e),d(t,u),l&&p(),p=$(t,"click",a[6])},p:m,d(a){a&&r(t),p()}}}function G(a){let t;return{c(){t=x("Stop Mode")},l(a){t=E(a,"Stop Mode")},m(a,e){c(a,t,e)},d(a){a&&r(t)}}}function U(a){let t;return{c(){t=x("Play Mode")},l(a){t=E(a,"Play Mode")},m(a,e){c(a,t,e)},d(a){a&&r(t)}}}function q(a){let t,e,i,s;const m=new D({props:{active:a[2]==a[14],data:a[12],read:"/read/"+a[12].id}});function x(...t){return a[11](a[14],...t)}return{c(){t=n("div"),f(m.$$.fragment),e=u()},l(a){t=o(a,"DIV",{});var n=l(t);p(m.$$.fragment,n),e=g(n),n.forEach(r)},m(a,n,o){c(a,t,n),h(m,t,null),d(t,e),i=!0,o&&s(),s=$(t,"click",x)},p(t,e){a=t;const n={};4&e&&(n.active=a[2]==a[14]),1&e&&(n.data=a[12]),1&e&&(n.read="/read/"+a[12].id),m.$set(n)},i(a){i||(v(m.$$.fragment,a),i=!0)},o(a){y(m.$$.fragment,a),i=!1},d(a){a&&r(t),b(m),s()}}}function z(a){let t,e,s,m,$,j,I,M,k,O,S,P,D,H,V,N,z=Object.keys(a[3].data).map(a[8]).map(J).join("")+"",Q=Object.keys(a[3].meta).map(a[9]).map(K).join("")+"",W=Object.keys(a[3].info).map(a[10]).map(R).join("")+"";function X(a,t){return a[1]?F:C}let Y=X(a),Z=Y(a);function _(a,t){return a[1]?U:G}let aa=_(a),ta=aa(a);const ea=new A({props:{color:"warning",val:a[3].meta.loaded,max:a[3].meta.total}}),na=new A({props:{color:"warning",val:a[3].meta.currentTime,max:a[3].meta.duration}});let oa=a[0],la=[];for(let t=0;t<oa.length;t+=1)la[t]=q(B(a,oa,t));const ra=a=>y(la[a],1,1,()=>{la[a]=null});return{c(){t=n("div"),e=n("div"),Z.c(),s=u(),ta.c(),m=x("\n\n\n  Loading\n  "),f(ea.$$.fragment),$=x("\n\n  Playing\n  "),f(na.$$.fragment),j=u(),I=n("hr"),M=u(),k=n("ol"),O=u(),S=n("ol"),P=u(),D=n("ol"),H=u(),V=n("div");for(let a=0;a<la.length;a+=1)la[a].c();this.h()},l(a){t=o(a,"DIV",{class:!0});var n=l(t);e=o(n,"DIV",{class:!0});var i=l(e);Z.l(i),s=g(i),ta.l(i),m=E(i,"\n\n\n  Loading\n  "),p(ea.$$.fragment,i),$=E(i,"\n\n  Playing\n  "),p(na.$$.fragment,i),j=g(i),I=o(i,"HR",{}),M=g(i),k=o(i,"OL",{}),l(k).forEach(r),O=g(i),S=o(i,"OL",{}),l(S).forEach(r),P=g(i),D=o(i,"OL",{}),l(D).forEach(r),i.forEach(r),H=g(n),V=o(n,"DIV",{class:!0});var c=l(V);for(let a=0;a<la.length;a+=1)la[a].l(c);c.forEach(r),n.forEach(r),this.h()},h(){i(e,"class","col-lg-8"),i(V,"class","col-lg-4"),i(t,"class","row")},m(a,n){c(a,t,n),d(t,e),Z.m(e,null),d(e,s),ta.m(e,null),d(e,m),h(ea,e,null),d(e,$),h(na,e,null),d(e,j),d(e,I),d(e,M),d(e,k),k.innerHTML=z,d(e,O),d(e,S),S.innerHTML=Q,d(e,P),d(e,D),D.innerHTML=W,d(t,H),d(t,V);for(let a=0;a<la.length;a+=1)la[a].m(V,null);N=!0},p(a,[t]){Y===(Y=X(a))&&Z?Z.p(a,t):(Z.d(1),(Z=Y(a))&&(Z.c(),Z.m(e,s))),aa!==(aa=_(a))&&(ta.d(1),(ta=aa(a))&&(ta.c(),ta.m(e,m)));const n={};8&t&&(n.val=a[3].meta.loaded),8&t&&(n.max=a[3].meta.total),ea.$set(n);const o={};if(8&t&&(o.val=a[3].meta.currentTime),8&t&&(o.max=a[3].meta.duration),na.$set(o),(!N||8&t)&&z!==(z=Object.keys(a[3].data).map(a[8]).map(J).join("")+"")&&(k.innerHTML=z),(!N||8&t)&&Q!==(Q=Object.keys(a[3].meta).map(a[9]).map(K).join("")+"")&&(S.innerHTML=Q),(!N||8&t)&&W!==(W=Object.keys(a[3].info).map(a[10]).map(R).join("")+"")&&(D.innerHTML=W),21&t){let e;for(oa=a[0],e=0;e<oa.length;e+=1){const n=B(a,oa,e);la[e]?(la[e].p(n,t),v(la[e],1)):(la[e]=q(n),la[e].c(),v(la[e],1),la[e].m(V,null))}for(T(),e=oa.length;e<la.length;e+=1)ra(e);w()}},i(a){if(!N){v(ea.$$.fragment,a),v(na.$$.fragment,a);for(let a=0;a<oa.length;a+=1)v(la[a]);N=!0}},o(a){y(ea.$$.fragment,a),y(na.$$.fragment,a),la=la.filter(Boolean);for(let a=0;a<la.length;a+=1)y(la[a]);N=!1},d(a){a&&r(t),Z.d(),ta.d(),b(ea),b(na),L(la,a)}}}const J=a=>`<li>${a}</li>`,K=a=>`<li>${a}</li>`,R=a=>`<li>${a}</li>`;function Q(a,t,e){const n=(o=o||Object.create(null),{on:function(a,t){(o[a]||(o[a]=[])).push(t)},off:function(a,t){o[a]&&o[a].splice(o[a].indexOf(t)>>>0,1)},emit:function(a,t){(o[a]||[]).slice().map(function(a){a(t)}),(o["*"]||[]).slice().map(function(e){e(a,t)})}});var o;let{collection:l=[]}=t;j(()=>{n.emit("stop")});let r=l.map(a=>({data:{},info:a,meta:{currentTime:0,duration:0,ready:!1}})),i=!1,s=0,c=r[0];n.on("play",async({index:a})=>{e(1,i=!0);r.filter(a=>a.data.src).filter(a=>!a.data.paused).map(a=>(a.data.pause(),a.data.currentTime=0,a));try{e(3,c.data.currentTime=0,c),await c.data.play(),console.log("playing")}catch(a){console.error("not playing",a)}n.emit("preload",{index:a+1})}),n.on("stop",()=>{e(1,i=!1);r.filter(a=>a.data.src).filter(a=>!a.data.paused).map(a=>(a.data.pause(),a.data.currentTime=0,a))}),n.on("load",({index:a,play:t})=>{let e=r[a];console.log(`load got track ${e.info.title}`),console.log(`load loading ${e.info.audio}`),e.data.src||(e.data=new Audio(e.info.audio)),4===e.data.readyState&&(console.log(`bootleg canplaythrough ${e.info.title}`),e.meta.ready=!0,t&&n.emit("play",{index:a})),e.data.addEventListener("loadeddata",()=>{e.meta.duration=e.data.duration}),e.data.addEventListener("progress",function(a){a.lengthComputable}),e.data.addEventListener("timeupdate",a=>{e.meta.currentTime=e.data.currentTime}),e.data.addEventListener("canplaythrough",()=>{e.meta.ready||(e.meta.ready=!0,console.log(`real canplaythrough ${e.info.title}`),t&&n.emit("play",{index:a}))})}),n.on("preload",({index:a,play:t})=>{let e=a;e+1>r.length&&(e=0);let n=r[a];console.log(`pre-load got track ${n.info.title}`),console.log(`pre-load loading ${n.info.audio}`),n.data.src||(n.data=new Audio(n.info.audio)),4===n.data.readyState&&(n.meta.ready=!0,console.log(`Pre-loaded ${n.info.title}`)),n.data.addEventListener("loadeddata",()=>{n.meta.duration=n.data.duration}),n.data.addEventListener("timeupdate",a=>{n.meta.currentTime=n.data.currentTime}),n.data.addEventListener("canplaythrough",()=>{n.meta.ready||(n.meta.ready=!0,console.log(`Pre-loaded ${n.info.title}`))})}),n.on("select",({index:a})=>{console.log(`Selecting ${r[a].info.title}`),e(2,s=a),e(3,c=r[s]),console.log(`Loading ${c.info.title}`),n.emit("load",{index:a,play:!0})}),I(()=>{setInterval(function(){e(3,c=r[s])},300)});return a.$set=(a=>{"collection"in a&&e(0,l=a.collection)}),[l,i,s,c,n,r,()=>n.emit("stop"),()=>{n.emit("select",{index:s})},a=>`${a}: ${c.data[a]}`,a=>`${a}: ${c.meta[a]}`,a=>`${a}: ${c.info[a]}`,a=>n.emit("select",{index:a})]}class W extends a{constructor(a){super(),t(this,a,Q,z,e,{collection:0})}}function X(a){let t,e,s,m,$,x,E;document.title=t=a[1].title;const T=new W({props:{collection:a[0]}}),w=new P({});return{c(){e=u(),s=n("main"),m=n("section"),$=n("div"),f(T.$$.fragment),x=u(),f(w.$$.fragment),this.h()},l(a){M('[data-svelte="svelte-cjhwof"]',document.head).forEach(r),e=g(a),s=o(a,"MAIN",{role:!0});var t=l(s);m=o(t,"SECTION",{});var n=l(m);$=o(n,"DIV",{class:!0});var i=l($);p(T.$$.fragment,i),i.forEach(r),n.forEach(r),t.forEach(r),x=g(a),p(w.$$.fragment,a),this.h()},h(){i($,"class","container"),i(s,"role","main")},m(a,t){c(a,e,t),c(a,s,t),d(s,m),d(m,$),h(T,$,null),c(a,x,t),h(w,a,t),E=!0},p(a,[e]){(!E||2&e)&&t!==(t=a[1].title)&&(document.title=t);const n={};1&e&&(n.collection=a[0]),T.$set(n)},i(a){E||(v(T.$$.fragment,a),v(w.$$.fragment,a),E=!0)},o(a){y(T.$$.fragment,a),y(w.$$.fragment,a),E=!1},d(a){a&&r(e),a&&r(s),b(T),a&&r(x),b(w,a)}}}function Y(a,t,e){const n=O();let o=null,l=k().filter(a=>a.audio);function r(){e(0,l=l.map(a=>(a.ago=S(a.date).from(S()),a))),e(0,l=l.map(a=>(a.today=S().diff(S(a.date),"days")<1,a))),n.blinkenlighten&&(e(0,l=l.map(a=>(a.ago=S(S(a.date).add(parseInt(31*Math.random()),"days")).from(S()),a))),e(0,l=l.map((a,t)=>(a.today=Math.random()<.5,a))))}return r(),j(()=>{clearInterval(o)}),I(()=>{o=setInterval(r,n.recalculateInterval)}),[l,n]}export default class extends a{constructor(a){super(),t(this,a,Y,X,e,{})}}
